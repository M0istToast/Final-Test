<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POYOZO</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="Header">
    <div class="button"><p class="Site-name">POYOZO</p></div>
    <div class="button">Home</div>
    <div class="search-bar">
      <input type="text" placeholder="Search games...">
    </div>
    <div class="button">About</div>
    <div class="button">Contact</div>

    <div class="safe-mode-toggle">
      <label>
        <input type="checkbox" id="safeMode" checked>
        Safe Mode
      </label>
    </div>
  </div>

  <div class="Main">
    <div class="Nav-left">
      <h3>Navigation</h3>
      <ul>
        <li><a href="#">Popular Games</a></li>
        <li><a href="#">New Releases</a></li>
        <li><a href="#">Upcoming</a></li>
        <li><a href="#">Top Rated</a></li>
        <li><a href="#">Old Classics</a></li>
      </ul>
    </div>

    <div class="Main-Grid" id="games"></div>
  </div>

  <script>
    const apiKey = "e0e37af7f0f8406ba25a09b1236c40dd";
    const gamesContainer = document.getElementById("games");
    const safeModeToggle = document.getElementById("safeMode");
    let safeModeOn = true;

    async function fetchGames(url) {
      try {
        gamesContainer.innerHTML = "<p>Loading games...</p>";
        const response = await fetch(url);
        const data = await response.json();
        gamesContainer.innerHTML = "";

        data.results.forEach(game => {
          const isMature =
            game.esrb_rating?.name === "adults only" ||
            game.tags?.some(g => g.name.toLowerCase().includes("adult")) ||
            game.tags?.some(g => g.name.toLowerCase().includes("nsfw"));

          const blurClass = (isMature && safeModeOn) ? "blurred" : "";

          const gameDiv = document.createElement("div");
          gameDiv.classList.add("game");

          gameDiv.innerHTML = 
          `<div class="game-card-content ${blurClass}">
              <img src="${game.background_image}" alt="${game.name}" class="game-card-content" />
            </div>

            <h3>${game.name}</h3>
            <h4>Rating: ${game.rating} / 5</h4>
            <h4>Released: ${game.released}</h4>
            <h4>Genres: ${game.genres.map(g => g.name).join(", ")}</h4>
            <h4>Tags: ${game.tags ? game.tags.map(t => t.name).join(", ") : "N/A"}</h4>
            <h4>Clip Available: ${game.clip ? "Yes" : "No"}</h4>
            <h4>Description: ${game.description_raw ? game.description_raw.substring(0, 100) + "..." : "N/A"}</h4>
            

            ${isMature ? `<span class="mature-badge">18+</span>` : ""}
          `;

          gamesContainer.appendChild(gameDiv);
        });
      } catch (error) {
        console.error("Error fetching games:", error);
        gamesContainer.innerHTML = "<p>Failed to load games.</p>";
      }
    }

    const endpoints = {
      popular: `https://api.rawg.io/api/games?key=${apiKey}&ordering=-rating&page_size=40`,
      new: `https://api.rawg.io/api/games?key=${apiKey}&dates=2025-01-01,2025-12-31&ordering=-released&page_size=40`,
      upcoming: `https://api.rawg.io/api/games?key=${apiKey}&dates=2025-11-01,2026-12-31&ordering=released&page_size=40`,
      top: `https://api.rawg.io/api/games?key=${apiKey}&ordering=-metacritic&page_size=40`,
      old: `https://api.rawg.io/api/games?key=${apiKey}&dates=2000-01-01,2010-12-31&ordering=-released&page_size=40`
    };

    fetchGames(endpoints.popular);

    document.querySelectorAll(".Nav-left a").forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        document.querySelectorAll(".Nav-left a").forEach(a => a.classList.remove("active"));
        e.target.classList.add("active");

        const text = e.target.textContent.trim().toLowerCase();
        if (text.includes("popular")) fetchGames(endpoints.popular);
        else if (text.includes("new")) fetchGames(endpoints.new);
        else if (text.includes("upcoming")) fetchGames(endpoints.upcoming);
        else if (text.includes("top")) fetchGames(endpoints.top);
        else if (text.includes("old")) fetchGames(endpoints.old);
      });
    });

    // SAFE MODE BEHAVIOR (UPDATED)
    safeModeToggle.addEventListener("change", () => {
      safeModeOn = safeModeToggle.checked;

      document.querySelectorAll(".game").forEach(card => {
        const badge = card.querySelector(".mature-badge");
        const content = card.querySelector(".game-card-content");

        if (!content) return;

        if (badge && safeModeOn) {
          content.classList.add("blurred");
        } else {
          content.classList.remove("blurred");
        }
      });
    });
  </script>
</body>
</html>
